<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Anna Syme">
    <link rel="canonical" href="https://plant-genomics.github.io/training/modules/chloroplast_assembly/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Chloroplast assembly - Plant Genomics Training</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../css/style.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Assemble and annotate a chloroplast genome", url: "#_top", children: [
              {title: "What is genome assembly?", url: "#what-is-genome-assembly" },
              {title: "What's in this tutorial?", url: "#whats-in-this-tutorial" },
              {title: "Get data", url: "#get-data" },
              {title: "Read quality", url: "#read-quality" },
              {title: "Assemble", url: "#assemble" },
              {title: "Polish", url: "#polish" },
              {title: "View reads", url: "#view-reads" },
              {title: "Annotate", url: "#annotate" },
              {title: "Repeat with new data", url: "#repeat-with-new-data" },
              {title: "See this history in Galaxy", url: "#see-this-history-in-galaxy" },
              {title: "See this workflow in Galaxy", url: "#see-this-workflow-in-galaxy" },
              {title: "What's next?", url: "#whats-next" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <h3 id="assemble-and-annotate-a-chloroplast-genome">Assemble and annotate a chloroplast genome</h3>
<h4 id="what-is-genome-assembly">What is genome assembly?</h4>
<ul>
<li>Genome assembly is the process of joining together DNA sequencing fragments into longer pieces, ideally up to chromosome lengths.</li>
<li>The DNA fragments are produced by DNA sequencing machines, and are called &ldquo;reads&rdquo;. These are in lengths of about 150 base pairs, to up to a million (or more) base pairs, depending on the sequencing technology used. Currently, most reads are from Illumina (short), PacBio (long) or Oxford Nanopore (long and extra-long).</li>
<li>It is difficult to assemble plant genomes as they are often large (for example, 3,000,000,000 base pairs), have many repeat regions (such as transposons), and may be polyploid.</li>
<li>This tutorial shows genome assembly for a smaller data set - the plant chloroplast genome - a circular chromosome about 160,000 base pairs long.</li>
<li>The process shown here is applicable to assembling plant nuclear genomes but there would be extra steps (and much more time) involved. For example, additional sequencing would usually be run on 10X, BioNano or HiC to produce information to link up longer nuclear chromosome pieces and to separate out the maternal and paternal haplotypes.</li>
</ul>
<h4 id="whats-in-this-tutorial">What&rsquo;s in this tutorial?</h4>
<ul>
<li>The chloroplast genome of the sweet potato has been sequenced.</li>
<li>This has produced many sequencing reads - DNA fragments.</li>
<li>We will try to join these reads together to make the whole chloroplast genome sequence.</li>
<li>We will use the Galaxy Australia platform (a web page) to run our analysis.</li>
<li>This tutorial assumes some familiarity with Galaxy and bioinformatics - if you are new to either of these, we recommend the <a href="https://galaxy-au-training.github.io/tutorials/">Galaxy Australia Training</a> tutorials <em>Get started, Learn key tasks, Quality control, Genome assembly, </em>and<em> Genome annotation</em>, as this chloroplast genome assembly tutorial is slightly more complicated.</li>
<li>You can follow all the steps, or skip the <op>optional</op> steps:</li>
<li><st>Get data &rarr; <op>Read quality</op> &rarr; Assemble&rarr; Polish &rarr; <op>View reads</op>  &rarr; <op>Annotate</op>  &rarr; <op>Repeat with new data</op>   </st></li>
</ul>
<h4 id="get-data">Get data</h4>
<ul>
<li>Log in to <a href="https://usegalaxy.org.au/">Galaxy Australia</a> and create a new history.</li>
<li>The data is from this paper: <a href="https://doi.org/10.12688/gatesopenres.12856.1">Zhou C, Duarte T, Silvestre R et al. 2018</a>, hosted at EBI ENA.
<!--How I got these files: see text at end of this document --></li>
<li>Original FASTQ reads: Illumina (SRR6828568) and Nanopore (SRR6828567).</li>
<li>These data sets have been highly reduced in size for this tutorial.</li>
<li>In a new browser tab, go to this webpage <a href="http://doi.org/10.5281/zenodo.3567224">at this link</a>.</li>
<li>Find the file called <fn>sweet-potato-chloroplast-illumina-reduced.fastq</fn></li>
<li>Right click on file name: select &ldquo;copy link address&rdquo;</li>
<li>In Galaxy, go to <ss>Get Data</ss> and then <ss>Upload File</ss></li>
<li>Click <ss>Paste/Fetch data</ss></li>
<li>A box will appear: paste in link address</li>
<li>Click <ss>Start</ss>; click <ss>Close</ss></li>
<li>The file will now appear in the top of your history panel.</li>
<li>Repeat for the Nanopore reads <fn>sweet-potato-chloroplast-nanopore-reduced.fastq</fn>.</li>
<li>We now have two FASTQ read files in our history.</li>
<li>Click on the eye icon next to one of the FASTQ sequence files.</li>
<li>View the file in the centre Galaxy panel.</li>
</ul>
<h4 id="read-quality">Read quality</h4>
<ul>
<li><op>Optional. Skip this section for a quicker tutorial</op></li>
<li>In the tool panel, search for Nanoplot</li>
<li>[to do - run details] [to do - results] what does it mean, see sweet potato nanoplot - why is weighted histogram of read lengths have some that are in negative?/ eg NanoStats / average read length = 7000 / av quality = 10 / 2000 reads / 13 million bases</li>
</ul>
<h4 id="assemble">Assemble</h4>
<ul>
<li><st>Assemble:</st></li>
<li>In the tool panel, search for &ldquo;flye&rdquo;, and click on &ldquo;Assembly of long and error-prone reads&rdquo;.</li>
<li>For <ss>Input reads</ss> select <fn>sweet-potato-chloroplast-nanopore-reduced.fastq</fn></li>
<li>Leave other settings as default, except for <ss>estimated genome size</ss> add <fn>160000</fn></li>
<li>Click <ss>Execute</ss></li>
<li><st>View assembly outputs:</st></li>
<li>There are five output files.</li>
<li>View the <fn>log</fn> file and scroll to the end. How many contigs were assembled? What is the length of the assembly?</li>
<li>View the <fn>assembly_info</fn> file. What are the contig names? What does the &ldquo;graph_path&rdquo; show? <!-- that contig 2 has inverted repeats --></li>
<li>The assembly sequence is in the <fn>scaffolds</fn>. Re-name this <fn>flye-assembly.fasta</fn></li>
<li>Optional: Download the <fn>Graphical Fragment Assembly</fn></li>
<li>Open the Bandage program (add link).</li>
<li>Go to <ss>File: load graph</ss> then <ss>Draw graph</ss></li>
<li>What is your interpretation of this assembly graph?
<!--
It looks like the LSC and SSC fragments are joined by a collapsed repeat (the inverted repeat)
-->
<img alt="assembly graph" src="../images/flye-assembly-graph.png" />
[to do - check the lengths of these graph contigs match the lengths in the flye output files]
[to do - check the contig naming - note that it is changed in bandage?]</li>
</ul>
<h4 id="polish">Polish</h4>
<ul>
<li>Short illumina reads are more accurate the nanopore reads. We will use them to correct errors in the nanopore assembly.</li>
<li><st>Map short reads to the assembly:</st></li>
<li>In the tool panel, search for &ldquo;bwa mem&rdquo;, and click on &ldquo;Map with BWA-MEM&rdquo;</li>
<li>For <ss>Will you select a reference genome from your history</ss> select <fn>Use a genome from history</fn></li>
<li>For <ss>Use the following dataset as the reference sequence</ss> select <fn>flye-assembly.fasta</fn></li>
<li>For <ss>Algorithm for constructing the BWT index</ss> select <fn>Auto. Let BWA decide</fn></li>
<li>For <ss>Single or Paired-end reads</ss> select <fn>Single</fn></li>
<li>For <ss>Select fastq dataset</ss> select <fn>sweet-potato-chloroplast-illumina-reduced.fastq</fn></li>
<li>For <ss>Set read groups information?</ss> select <fn>Do not set</fn></li>
<li>For <ss>Select analysis mode</ss> select <fn>1. Simple Illumina mode</ss></li>
<li>Click <ss>Execute</ss></li>
<li>This maps the short reads to the assembly, and creates an alignment file.</li>
<li>Re-name this file <fn>illumina.bam</fn></li>
<li><st>Polish the assembly:</st></li>
<li>In the tool panel, search for &ldquo;pilon&rdquo;, and click on &ldquo;pilon&rdquo;</li>
<li>For <ss>Source for reference genome used for BAM alignments</ss> select <fn>Use a genome from history</fn></li>
<li>For <ss>Select a reference genome</ss> select <fn>flye-assembly.fasta</fn></li>
<li>For <ss>Type automatically determined by pilon</ss> click <fn>Yes</fn></li>
<li>For <ss>Input BAM file</ss> select <fn>illumina.bam</fn></li>
<li>For <ss>Variant calling mode</ss> select <fn>No</fn></li>
<li>For <ss>Create changes file</ss> select <fn>Yes</fn></li>
<li>Click <ss>Execute</ss></li>
<li>This compares the short reads to the assembly, and creates a polished (corrected) assembly file.
<!-- option: run a second round of polishing. keep track of file naming, and will need to generate a new bam [map illumina reads to polished.fasta] --></li>
<li>Re-name the fasta output file <fn>polished-assembly.fasta</fn></li>
<li>Find and run the tool called &ldquo;Fasta statistics&rdquo; on this file.</li>
<li>How does it compare to the unpolished <fn>flye-assembly.fasta</fn>?
<!-- length 161333 compared to unpolished 160340; about 1k bases have been added back in; nanopore can have a lot of homopolymer deletions; the changes file shows lots of cases with a deletion changing to a base, there are also stretches of bases replaced--></li>
</ul>
<h4 id="view-reads">View reads</h4>
<ul>
<li><op>Optional. Skip this entire section for a quicker tutorial</op></li>
<li>We will look at the original sequencing reads mapped to the genome assembly.</li>
<li>In a new browser tab, go to this webpage <a href="http://doi.org/10.5281/zenodo.3567224">at this link</a>.</li>
<li>See the two files with the &ldquo;-tiny&rdquo; in their file name. These are very cut-down files of sequencing reads.</li>
<li>Upload these files to Galaxy, like we did in the first tutorial step, &ldquo;Import the Data&rdquo;.
<!-- later: these will be in shared history and/or shared data lib --></li>
<li><st>Map the reads:</st></li>
<li>Map the Illumina reads (the new &ldquo;tiny&rdquo; dataset) to the <fn>polished-assembly.fasta</fn>, the same way we did before, using bwa mem.</li>
<li>This creates one output file: re-name it <fn>illumina-tiny.bam</fn></li>
<li>Map the Nanopore reads (the new &ldquo;tiny&rdquo; dataset) to the <fn>polished-assembly.fasta</fn>. The settings will be the same, except <ss>Select analysis mode</ss> should be <fn>Nanopore</fn>.</li>
<li>This creates one output file: re-name it <fn>nanopore-tiny.bam</fn></li>
<li><st>Create a visualization of the mapped reads:</st></li>
<li>In the tool panel, search for &ldquo;JBrowse&rdquo;, and click on &ldquo;JBrowse genome browser&rdquo;</li>
<li>This tool creates a visualization of our genome assembly with some of the original sequencing reads mapped to it.</li>
<li>For <ss>Reference genome to display</ss> select <fn>polished-assembly.fasta</fn></li>
<li>For <ss>Produce Standalone Instance</ss> select <fn>Yes</fn></li>
<li>For <ss>Genetic Code</ss> select <fn>11. The Bacterial, Archaeal and Plant Plastid Code</fn></li>
<li>For <ss>JBrowse-in-Galaxy Action</ss> select <fn>New JBrowse instance</fn></li>
<li>Insert Track Group</li>
<li>Insert Annotation Track. This is our first track, or row, to be displayed under the reference genome.</li>
<li>For <ss>Track Category</ss> type in <fn>sequencing reads</fn></li>
<li>For <ss>Track Type</ss> select <fn>BAM pileups</fn></li>
<li>BAM track data: nanopore-tiny.bam</li>
<li>autogenerate SNP track? yes?</li>
<li>add zero to max chunk size or ok?</li>
<li>Leave the other track features as default.</li>
<li>Insert Annotation Track. This is our second track, or row, to be displayed under the reference genome.</li>
<li>Track type: BAM pileups</li>
<li>BAM track data: illumina-tiny.bam</li>
<li>autogenerate SNP track? yes?</li>
<li>add zero to max chunk size or ok?</li>
<li>Leave the other track features as default.</li>
<li>Execute</li>
<li>This may take a few minutes. There is one output file: re-name: <fn>assembly-and-reads</fn></li>
<li><st>View the JBrowse file:</st></li>
<li>View.</li>
<li>Two contigs in drop down.</li>
<li>zoom all the way out; zoom all the way in</li>
<li>change ref seq display.</li>
<li>see diffs bn long error nano reads and short low-error illumina reads
<!-- note that the coverage is quite uneven, but that these reads could have bias as they are those that mapped to a certain set of cp genomes. If this new genome has new bits, these may be in the long-read assembly but missing in short reads. --></li>
</ul>
<!-- Why would the polished assembly (the ref track) be different to the reads - wouldn't these snps correct these places? maybe would need another round+ of polishing. -->

<ul>
<li>add a question</li>
<li>add image</li>
</ul>
<h4 id="annotate">Annotate</h4>
<ul>
<li>
<p><op>Optional. Skip this step for a quicker tutorial</op></p>
</li>
<li>
<p>Annotation is ....</p>
</li>
</ul>
<p>download the polished.fasta
https://chlorobox.mpimp-golm.mpg.de/geseq.html
web: geseq: upload the fasta file.
linear
options: generate codon-based alignments
Blat - default
hmmer - tick emrbyophyta
argaron tick
tRNAscan - tick
accept disclaimer
submit: (5 mins): tutorial break</p>
<p>contigA: gff3: click on it: click download at the bottom
contigB: repeat</p>
<p>click on ogdraw to look
[Note: can see the repeated 16sRNA and 23sRNA &ndash; although one of sets only has fragments? not full length? &ndash; also, where does the Inverted Repeat start - is is ycf2?]</p>
<p>upload geseq.gff3 to galaxy</p>
<p>Get data
choose local file x2, start, close</p>
<p>JBrowse: geseq.gff3 and polished.fasta</p>
<p>two contigs</p>
<p>re-name view polished.fasta annotations</p>
<p>[note: two gff tracks displayed under each but one will be empty under each.]</p>
<p>annotation: a constantly-improving process as more info for matching to seq string, seq structure, etc.
can be multiple annotations under each feature depending on the database matched.</p>
<p>[option: repeat jbrowse, add the barrnap gff track to compare where that mapped the rRNAs - can see that the geseq annotation is slightly different]</p>
<h4 id="repeat-with-new-data">Repeat with new data</h4>
<ul>
<li><op>Optional. Skip this step for a quicker tutorial</op></li>
</ul>
<h4 id="see-this-history-in-galaxy">See this history in Galaxy</h4>
<p>If you want to see this Galaxy history without performing the steps above:</p>
<ul>
<li>Log in to Galaxy Australia: <a href="https://usegalaxy.org.au/">https://usegalaxy.org.au/</a></li>
<li>Go to <ss>Shared Data</ss></li>
<li>Click <ss>Histories</ss></li>
<li>Click <fn>Completed-assembly-analysis</fn></li>
<li>Click <ss>Import</ss> (at the top right corner)</li>
<li>The analysis should now be showing as your current history.</li>
</ul>
<h4 id="see-this-workflow-in-galaxy">See this workflow in Galaxy</h4>
<h4 id="whats-next">What&rsquo;s next?</h4>
<p>You can find more tutorials at</p>
<p>Galaxy Australia Training</p>
<p>and</p>
<p>the Galaxy Training Network:</p>
<ul>
<li><a href="http://galaxyproject.github.io/training-material/">http://galaxyproject.github.io/training-material/</a></li>
</ul>
<!-- File prep:

Created history: sweet potato chloroplast tutorial data

Nanopore data
Galaxy: Get data: EBI SRA:
enter in search box: SRR6828567
click on the link under run
under FASTQ files (Galaxy) click on File 1
will upload into current history

repeat for Illumina data: SRR6828568
note this data says paired but there is only one file.
these don't look paired, I uncompressed and looked at the last reads in the file and they are numbered xxx/1
probably ok to use though as just using for correction

Renamed.
Uncompressed (don't know what this tool is or how to find it in tools).
Reduced.
Very reduced (for a bam example).

the paper used slightly diff assembly method, which included correcting nanopore reads with illumina reads, trimming low qual, assembling nano with canu, then polish with pilon and illumina.

=> illumina file
[I found this by ncbi - looking at the Tanzania sample (see paper supp table S1) that gave the nanopore file (which is easy to find bc only one nanopore file in the set, but lots of illumina) - then searched for all reads under under this, and found the accompanying illumina file.

I've cut down the size of these datasets and hosted the data on Zenodo (with permission from author Lachlan Coin) at http://doi.org/10.5281/zenodo.3567224
-->

  <br>
</div>

<footer class="col-md-12 wm-page-content"><p>&copy; The authors; 2019-</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>